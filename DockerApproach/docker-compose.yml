version: '3.7'

volumes:
  site_root:
  db_data:

networks:
  db_network:
    driver: bridge
  httpd_network:
    driver: bridge

services:

  httpd:
    image: httpd:2.4.38
    container_name: httpd
    env_file: .env
    volumes:
      - ./config/apache/httpd.conf:/usr/local/apache2/conf/httpd.conf
      - ./config/apache/extra/httpd-vhosts.conf:/usr/local/apache2/conf/extra/httpd-vhosts.conf
      # - site_root:/usr/local/apache2/htdocs
    ports:
      - 1337:80
    networks:
      - httpd_network
    depends_on:
      - webapp-fpm
    # comment in www.conf line in webapp-fpm

  webapp-fpm:
    image: drupal:8.6.13-fpm
    container_name: webapp-fpm
    volumes:
      - site_root:/var/www/html/
      - ./config/php/www.conf:/usr/local/etc/php-fpm.d/www.conf
    restart: always
    networks:
      - db_network
      - httpd_network
    depends_on:
      - db

  db:
    image: mysql:8.0.15
    container_name: db
    command: --default-authentication-plugin=mysql_native_password
    env_file: .env
    networks:
      - db_network
    volumes:
      - db_data:/var/lib/mysql
    restart: always


  # webapp-apache:
  #   image: drupal:8.6.13-apache
  #   container_name: webapp-apache
  #   ports:
  #     - 9000:80
  #   volumes:
  #     - site_root:/var/www/html/
  #   restart: always
  #   networks:
  #     - db_network
  #     - httpd_network
  #   depends_on:
  #     - db

  # phpmyadmin:
  #   image: phpmyadmin/phpmyadmin:4.7
  #   container_name: phpmyadmin
  #   env_file: .env
  #   environment:
  #     PMA_HOST: ${MYSQL_HOST}
  #     PMA_USER: ${MYSQL_USER}
  #     PMA_PASSWORD: ${MYSQL_PASSWORD}
  #     PMA_ARBITRARY: 0
  #     PMA_PORT: 3306
  #   restart: always
  #   ports:
  #     - 8888:80
  #   networks:
  #     - db_network
  #   volumes:
  #     - /sessions
  #   depends_on:
  #     - db

#  nginx:
#     image: nginx:1.15.10
#     container_name: nginx
#     ports:
#       - "8088:80"
#     volumes:
#       - ./config/nginx/default.conf:/etc/nginx/conf.d/default.conf
#       - site_root:/var/www/html/
#     networks:
#       - httpd_network
#     depends_on:
#       - webapp-fpm
#   comment out www.conf line in webapp-fpm