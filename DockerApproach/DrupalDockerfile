# drupal:8.6.13 Dockerfile at https://github.com/docker-library/drupal/blob/master/8.6/fpm/Dockerfile

FROM drupal:8.6.13-fpm

WORKDIR /var/www

RUN cd /tmp && \
    apt update && \
    apt install --no-install-recommends -y wget git curl tree nano

# Install composer, drush
RUN php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" && \
    php composer-setup.php && \
    mv composer.phar /usr/bin/composer && \
    php -r "unlink('composer-setup.php');"
RUN wget -O drush.phar https://github.com/drush-ops/drush-launcher/releases/download/0.4.2/drush.phar && \
    chmod +x drush.phar && \
    mv drush.phar /usr/bin/drush
RUN rm -R /var/www
RUN composer create-project drupal-composer/drupal-project:8.x-dev /var/www --stability dev --no-interaction

COPY ./config/drupal/settings.php /var/www/web/sites/default/settings.php
COPY ./config/drupal/drupal_entrypoint /usr/local/bin/

RUN mkdir -p /var/www/sync && \
   chown -R www-data:www-data /var/www/sync && \
   chown -R www-data:www-data /var/www/web/sites/default/settings.php

WORKDIR /var/www/html

ENTRYPOINT ["drupal_entrypoint"]
