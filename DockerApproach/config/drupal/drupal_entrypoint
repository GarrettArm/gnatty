#!/usr/bin/env bash

set -e

# if drupal install directory does not exist, make drupal.  If it exists, don't overwrite it.
if [ ! -d /var/www/html/web ]; then
    echo "Making drupal from scratch"
    cd /tmp 
    apt update
    apt install wget git curl -y
    php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');" && \
        php composer-setup.php && \
        mv composer.phar /usr/bin/composer && \
        php -r "unlink('composer-setup.php');"
    wget -O drush.phar https://github.com/drush-ops/drush-launcher/releases/download/0.4.2/drush.phar && \
        chmod +x drush.phar && \
        mv drush.phar /usr/bin/drush
    composer create-project drupal-composer/drupal-project:8.x-dev /var/www/html/ --stability dev --no-interaction
    mkdir -p /var/www/html/config/sync
    chown -R www-data:www-data /var/www/html/config/sync
    chown -R www-data:www-data /var/www/html/web
else
    echo "Using drupal from your drupal_app folder"
fi

php-fpm
